# RAGAS 평가 지표: 상세 가이드

## 1. RAGAS란 무엇인가?

RAGAS(Retrieval-Augmented Generation Assessment)는 RAG(Retrieval-Augmented Generation) 파이프라인의 성능을 평가하기 위해 특화된 프레임워크입니다.

RAG는 대규모 언어 모델(LLM)이 외부 지식 베이스(예: 문서 모음, DB)에서 관련 정보를 검색(Retrieve)하고, 이 정보를 바탕으로 답변을 생성(Generate)하는 방식입니다. 이 방식은 LLM의 환각(Hallucination) 현상을 줄이고, 최신 정보에 기반한 정확한 답변을 생성하게 해줍니다.

RAGAS는 이러한 RAG 시스템의 두 가지 핵심 구성 요소, 즉 **검색(Retrieval)**과 **생성(Generation)**이 얼마나 잘 작동하는지를 각각, 그리고 종합적으로 평가하는 다양한 지표를 제공합니다. Ground Truth(사람이 직접 만든 정답) 데이터가 없는 상황에서도 평가가 가능하다는 큰 장점이 있습니다.

---

## 2. 핵심 평가 지표 (Core Metrics)

RAGAS의 평가는 크게 **생성(Generation)** 부분과 **검색(Retrieval)** 부분으로 나뉩니다.

### Ⅰ. Generation: 생성된 답변의 품질 평가

#### 1) Faithfulness (충실성 / 신뢰성)

- **🤔 무엇을 평가하나요?**
  - 생성된 답변이 **제공된 컨텍스트(문맥)에 얼마나 충실한가**를 평가합니다. 즉, 답변이 컨텍스트에 없는 내용을 지어내거나 사실과 다른 내용을 포함하지는 않는지를 측정합니다.

- **💡 왜 중요한가요?**
  - LLM의 가장 큰 문제점인 **환각(Hallucination)** 현상을 측정하는 핵심 지표입니다. Faithfulness 점수가 높을수록 생성된 답변이 주어진 정보에 근거하고 있어 신뢰할 수 있음을 의미합니다.

- **⚙️ 어떻게 측정하나요?**
  1. RAGAS는 먼저 LLM을 이용해 생성된 답변을 여러 개의 개별적인 주장(Statement)으로 분해합니다.
  2. 각각의 주장에 대해, LLM이 컨텍스트 내에서 그 주장을 뒷받침하는 내용을 찾을 수 있는지 확인합니다.
  3. (전체 주장의 수) 중에서 (컨텍스트에서 뒷받침되는 주장의 수)의 비율을 계산하여 점수화합니다.

- **📊 예시:**
  - **컨텍스트:** "대한민국의 수도는 서울이다. 서울은 천만 명이 넘는 인구가 사는 대도시이다."
  - **답변 (Good):** "대한민국의 수도는 서울이며, 천만 명 이상의 인구가 거주합니다." -> Faithfulness: 1/1 (높음)
  - **답변 (Bad):** "대한민국의 수도는 서울이며, 주요 산업은 어업이다." -> '주요 산업은 어업'이라는 주장은 컨텍스트에 없으므로 Faithfulness 점수가 낮아집니다.

#### 2) Answer Relevancy (답변 관련성)

- **🤔 무엇을 평가하나요?**
  - 생성된 답변이 **사용자의 원본 질문에 얼마나 관련이 있는가**를 평가합니다. 답변이 불필요하게 길거나, 질문의 요점을 벗어나는 내용을 포함하는지 측정합니다.

- **💡 왜 중요한가요?**
  - 사용자의 질문 의도를 정확히 파악하고, 간결하고 핵심적인 답변을 제공하는 능력을 평가합니다. 점수가 낮다면, 답변이 길고 장황하거나 동문서답을 하고 있을 가능성이 높습니다.

- **⚙️ 어떻게 측정하나요?**
  - RAGAS는 LLM을 이용해 원본 질문과 생성된 답변 사이의 의미적 유사도를 측정합니다. 질문에서 여러 개의 키워드를 뽑아내고, 답변이 그 키워드들과 얼마나 관련이 있는지 등을 평가하여 점수화합니다.

- **📊 예시:**
  - **질문:** "대한민국의 수도는 어디인가요?"
  - **답변 (Good):** "대한민국의 수도는 서울입니다." -> Answer Relevancy: 높음
  - **답변 (Bad):** "서울은 대한민국의 수도이자 가장 큰 도시로, 경복궁, 남산타워 등 많은 관광지가 있습니다. 또한, 지하철 시스템이 매우 발달해 있어..." -> 질문은 수도가 어디인지만 물었지만, 답변이 너무 많은 부가 정보를 포함하므로 Answer Relevancy 점수가 낮아질 수 있습니다.


### Ⅱ. Retrieval: 검색된 컨텍스트의 품질 평가

#### 3) Context Precision (컨텍스트 정확성)

- **🤔 무엇을 평가하나요?**
  - 검색된 컨텍스트(문서 조각들) 중에서 **실제로 답변 생성에 유용한 정보가 얼마나 포함되어 있는가**를 평가합니다. '질문'과 '컨텍스트' 사이의 관련성을 봅니다.

- **💡 왜 중요한가요?**
  - 검색 시스템(Retriever)이 얼마나 정확하게 관련 있는 문서를 찾아내는지를 평가합니다. 불필요하거나 관련 없는 정보가 많이 섞여 있다면 Context Precision 점수는 낮아지고, 이는 LLM이 답변을 생성할 때 혼란을 주거나 노이즈로 작용할 수 있습니다.

- **⚙️ 어떻게 측정하나요?**
  1. RAGAS는 '질문'과 검색된 '컨텍스트'의 각 문장 사이의 관련성을 평가합니다.
  2. LLM을 사용하여 각 컨텍스트 문장이 질문에 대답하는 데 필요한 정보인지 아닌지를 "True" 또는 "False"로 판단합니다.
  3. (전체 컨텍스트 문장 수) 중에서 (질문에 관련된 문장 수, 즉 "True"의 수)의 비율을 계산하여 점수화합니다.

- **📊 예시:**
  - **질문:** "아이폰 15의 새로운 기능은 무엇인가요?"
  - **검색된 컨텍스트 (Good):**
    1. "아이폰 15는 USB-C 포트를 탑재했습니다." (관련 있음)
    2. "또한 다이나믹 아일랜드가 모든 모델에 확대 적용되었습니다." (관련 있음)
    -> Context Precision: 2/2 = 1.0 (높음)
  - **검색된 컨텍스트 (Bad):**
    1. "애플은 캘리포니아에 본사를 둔 기술 회사입니다." (관련 없음)
    2. "아이폰 15는 USB-C 포트를 탑재했습니다." (관련 있음)
    -> Context Precision: 1/2 = 0.5 (낮음)

#### 4) Context Recall (컨텍스트 재현율)

- **🤔 무엇을 평가하나요?**
  - **정답을 만드는 데 필요한 모든 정보가 검색된 컨텍스트에 포함되어 있는가**를 평가합니다. 이 지표는 Ground Truth(실제 정답)가 필요합니다.

- **💡 왜 중요한가요?**
  - 검색 시스템이 정답에 필요한 핵심 정보를 놓치지 않고 잘 찾아내는지를 평가합니다. Context Recall이 낮다면, 검색된 정보만으로는 질문에 완전하게 답변할 수 없다는 의미입니다.

- **⚙️ 어떻게 측정하나요?**
  1. RAGAS는 Ground Truth 답변의 각 문장에 대해, 그 의미와 일치하는 내용이 검색된 '컨텍스트'에 존재하는지 확인합니다.
  2. (Ground Truth 답변의 전체 문장 수) 중에서 (컨텍스트에서 그 내용이 확인되는 문장 수)의 비율을 계산하여 점수화합니다.

- **📊 예시:**
  - **질문:** "클린 아키텍처의 핵심 원칙은 무엇인가요?"
  - **Ground Truth (실제 정답):** "클린 아키텍처의 핵심 원칙은 의존성 규칙으로, 모든 소스 코드 의존성은 외부에서 내부로, 저수준 정책에서 고수준 정책으로 향해야 합니다."
  - **검색된 컨텍스트 (Good):**
    1. "... 의존성 규칙은 클린 아키텍처의 가장 중요한 규칙입니다. 소스 코드 의존성은 안쪽 원을 향해야 합니다..." (핵심 내용 포함)
    -> Context Recall: 1.0 (높음)
  - **검색된 컨텍스트 (Bad):**
    1. "클린 아키텍처는 로버트 C. 마틴이 제안했습니다. 계층 분리가 중요합니다..." (핵심 원칙인 '의존성 규칙'에 대한 내용 누락)
    -> Context Recall: 0.0 (낮음)

---

## 3. 종합 점수 (RAGAS Score)

RAGAS는 위 4가지 핵심 지표의 조화 평균(Harmonic Mean)을 계산하여 `ragas_score`라는 단일 점수를 제공합니다. 이 점수는 RAG 시스템의 전반적인 품질에 대한 빠른 스냅샷을 제공하며, 여러 버전의 RAG 시스템 성능을 비교할 때 유용합니다. 