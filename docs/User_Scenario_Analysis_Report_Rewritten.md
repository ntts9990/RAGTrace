# 사용자 행동 시나리오 기반 잠재적 위험 분석 보고서 (재작성)

## 1. 개요

본 문서는 RAGTrace 사용자의 예상 행동 시나리오를 정의하고, 각 시나리오에서 발생할 수 있는 잠재적 문제점과 위험 요소를 분석합니다. 이 분석의 목적은 시스템의 견고성과 사용자 경험(UX)을 저해할 수 있는 문제를 사전에 식별하고, 이에 대한 구체적인 개선 방안을 도출하는 데 있습니다.

---

## 2. 핵심 사용자 워크플로우 정의

RAGTrace의 핵심적인 사용자 워크플로우는 다음과 같이 단순화할 수 있습니다.

1.  **준비 (Preparation)**: 사용자는 평가에 필요한 데이터(질문, 컨텍스트, 정답 등)가 포함된 `CSV` 또는 `JSON` 파일을 로컬 환경에 준비합니다.
2.  **실행 (Execution)**: 사용자는 터미널을 통해 RAGTrace 애플리케이션을 실행하고, 준비된 데이터셋의 경로를 인자로 전달하여 평가를 시작합니다.
3.  **대기 (Waiting)**: 시스템은 데이터를 로드하고, 각 항목에 대한 답변을 생성한 후, Ragas 라이브러리를 통해 평가를 수행합니다. 이 과정 동안 사용자는 프로세스가 완료되기를 기다립니다.
4.  **확인 (Verification)**: 평가가 완료되면, 사용자는 터미널에 출력되거나 파일로 저장된 최종 평가 점수 및 결과를 확인합니다.

---

## 3. 시나리오별 잠재적 위험 및 개선 방안

위 워크플로우를 기반으로, 다음과 같은 4가지 주요 문제 시나리오를 예측하고 해결책을 제시합니다.

### 시나리오 1: 데이터 유효성 문제 (Invalid Data)

-   **상황**: 사용자가 준비한 데이터 파일에 필수 컬럼이 누락되었거나(예: `question` 필드가 없음), 특정 행의 값이 비어있거나, 데이터 형식이 잘못된 경우.
-   **잠재적 위험**:
    -   **시스템 다운**: 처리할 수 없는 데이터 구조로 인해 예기치 않은 `KeyError`, `ValueError` 등이 발생하여 전체 프로세스가 중단됩니다.
    -   **불친절한 오류**: 사용자에게 스택 트레이스(stack trace)와 같은 복잡한 오류 메시지가 그대로 노출되어, 원인을 파악하기 어렵게 만듭니다.
-   **개선 방안**: **데이터 사전 검증 (Pre-flight Check) 기능 도입**
    -   평가 로직을 실행하기 전에, 데이터의 스키마(필수 컬럼 존재 여부)와 내용(빈 값 여부)을 먼저 검증하는 단계를 추가합니다.
    -   문제가 발견되면, "항목 5의 'contexts' 필드가 비어있습니다."와 같이 사용자 친화적인 언어로 명확하게 문제를 알려주고, 평가 진행 여부를 선택하게 하거나 안전하게 프로세스를 중단시킵니다.

### 시나리오 2: 외부 API 장애 (External API Failure)

-   **상황**: 답변 생성을 위해 호출하는 외부 LLM API(예: Gemini)가 일시적으로 불안정하거나, 사용자의 API 키가 잘못되었거나, 할당된 요청량(Quota)을 초과한 경우.
-   **잠재적 위험**:
    -   **전체 실패**: 단 하나의 API 호출 실패가 전체 평가 프로세스를 중단시켜, 사용자는 아무런 결과도 얻지 못합니다.
    -   **결과 손실**: 이미 성공적으로 처리된 다른 데이터 항목들의 결과마저 모두 잃게 됩니다.
-   **개선 방안**: **방어적 설계 및 부분적 성공 처리**
    -   개별 API 호출을 `try-except` 블록으로 감싸, 특정 항목의 답변 생성에 실패하더라도 전체 프로세스가 중단되지 않도록 합니다.
    -   실패한 항목은 건너뛰거나, 빈 값으로 처리하여 나머지 항목들의 평가는 계속 진행합니다.
    -   최종 결과 보고 시, "총 100개 중 95개 성공, 5개 실패"와 같이 처리 상태를 요약하고, 실패한 항목의 상세 정보(예: API 오류 메시지)를 함께 제공하여 투명성을 높입니다.

### 시나리오 3: 대용량 데이터 처리 (Large-Scale Data)

-   **상황**: 사용자가 수천, 수만 건의 대용량 데이터셋으로 평가를 시도하는 경우.
-   **잠재적 위험**:
    -   **UI 멈춤 (Freezing)**: 동기(Synchronous) 방식으로 처리될 경우, 모든 작업이 완료될 때까지 터미널이나 UI가 멈춰버려 사용자는 진행 상황을 알 수 없고 다른 작업도 할 수 없습니다.
    -   **메모리 초과**: 대용량 데이터를 한 번에 메모리에 로드하다가 시스템의 한계를 초과하여 프로세스가 강제 종료될 수 있습니다.
-   **개선 방안**: **비동기 처리 및 백그라운드 실행 도입**
    -   `Celery`나 `FastAPI`의 `BackgroundTasks`와 같은 태스크 큐를 도입하여, 평가 작업을 백그라운드에서 비동기적으로 처리합니다.
    -   사용자가 평가를 요청하면 시스템은 즉시 작업 ID를 반환하고, 사용자는 별도의 명령어로 진행 상태를 확인하거나 작업 완료 알림을 받을 수 있습니다.
    -   데이터 처리 시 스트리밍(Streaming) 방식을 적용하여 메모리 사용량을 최적화합니다.

### 시나리오 4: 부실 데이터 입력 (Poor-Quality Data)

-   **상황**: 데이터의 형식은 유효하지만, 내용의 품질이 낮은 경우 (예: 질문이 "테스트" 한 단어이거나, 컨텍스트가 질문과 전혀 관련 없는 내용인 경우).
-   **잠재적 위험**:
    -   **의미 없는 결과**: 시스템은 정상적으로 평가를 완료하지만, `faithfulness`, `answer_relevancy` 등의 점수가 매우 낮게 나옵니다.
    -   **사용자 혼란**: 사용자는 낮은 점수의 원인이 자신의 데이터 품질 때문인지, RAG 시스템 자체의 성능 문제인지 판단하기 어려워 결과의 신뢰성에 의문을 갖게 됩니다.
-   **개선 방안**: **콘텐츠 품질 경고 시스템**
    -   사전 검증 단계에서 텍스트의 길이, 중복성, 특수문자 비율 등 간단한 지표를 통해 콘텐츠의 품질을 분석합니다.
    -   "일부 항목의 질문 또는 컨텍스트가 너무 짧아 평가 결과의 신뢰도가 낮을 수 있습니다."와 같은 경고 메시지를 제공하여, 사용자가 결과 해석 시 참고할 수 있도록 합니다.

---

## 4. 결론

사용자 행동 시나리오 기반의 선제적인 위험 분석과 개선은 시스템의 기술적 안정성을 넘어, 사용자의 신뢰를 얻는 데 핵심적인 역할을 합니다. 위에서 제안된 개선 방안들, 특히 **데이터 사전 검증**과 **API 장애 처리**는 사용자 경험을 크게 향상시킬 수 있으므로 우선적으로 적용하는 것을 권장합니다. 